<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Timeline</title>

        <link rel="stylesheet" href="timeline.css">
    </head>
    <body>
    	<br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br>

        <section class="abn_timeline__section" id="timeline">

            <div class="abn_timeline__container">

                <div class="abn_timeline__mid">
                    <div class="abn_timeline__mid_row abn_timeline__entry_point" style="">
                        <div class="abn_timeline__row_center_step"></div>
                        <div class="abn_timeline__mid_week_box">
                            
                        </div>
                        <div class="abn_timeline__row_content_box">
                            <div class="abn-timeline-time">
                                <img
                                    src="https://primalqueen.com/cdn/shop/files/calendar_36x38.png?v=11753303483607372404&format=png"
                                    alt="icon"
                                    class="calendar"
                                />
                                1 Week
                            </div>

                            <p class="text-center"><b>Feel the change: <br></b>  Reduced gum sensitivity and less bleeding during brushing</p>
                        </div>
                    </div>

                    <div class="abn_timeline__mid_row reverse">
                        <div class="abn_timeline__row_center_step "></div>
                        <div class="abn_timeline__mid_week_box">
                            <div class="abn_week_heading ">
                                
                            </div>
                        </div>
                        <div class="abn_timeline__row_content_box card-reverse float-left w-[38.5%] rounded-[10px] relative text-left">
                        	<div class="abn-timeline-time">
                                <img
                                    src="https://primalqueen.com/cdn/shop/files/calendar_36x38.png?v=11753303483607372404&format=png"
                                    alt="icon"
                                    class="calendar"
                                />
                                1 Month
                            </div>

                            <p class="text-center"><b>Healthier gums: <br></b> Stronger, firmer, and inflammation noticeably reduced</p>
                        </div>
                    </div>

                    <div class="abn_timeline__mid_row">
                        <div class="abn_timeline__row_center_step "></div>
                        <div class="abn_timeline__mid_week_box">
                            <div class="abn_week_heading ">
                                
                            </div>
                        </div>
                        <div class="abn_timeline__row_content_box card float-left w-[38.5%] rounded-[10px] relative text-left">
                            <div class="abn-timeline-time">
                                <img
                                    src="https://primalqueen.com/cdn/shop/files/calendar_36x38.png?v=11753303483607372404&format=png"
                                    alt="icon"
                                    class="calendar"
                                />
                                3 Months
                            </div>

                            <p class="text-center"><b>Pinker, stronger gums: <br></b> Reduced recession and improved protection against bacteria</p>
                        </div>
                    </div>

                    <div class="abn_timeline__mid_row reverse">
                        <div class="abn_timeline__row_center_step "></div>
                        <div class="abn_timeline__mid_week_box">
                            <div class="abn_week_heading ">
                                
                            </div>
                        </div>
                        <div class="abn_timeline__row_content_box card-reverse float-left w-[38.5%] rounded-[10px] relative text-left">
                            <div class="abn-timeline-time">
                                <img
                                    src="https://primalqueen.com/cdn/shop/files/calendar_36x38.png?v=11753303483607372404&format=png"
                                    alt="icon"
                                    class="calendar"
                                />
                                6 Month
                            </div>

                            <p class="text-center"><b>Fully revitalized: <br></b>Firm, pink gums that provide lasting strength and protection</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    	<br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br>

        <script>
            function distanceCalculation(div1, div2) {
                // Get the dimensions and positions of the divs
                const rect1 = div1.getBoundingClientRect();
                const rect2 = div2.getBoundingClientRect();

                // Calculate the center of each div
                const center1 = {
                    x: rect1.left + rect1.width / 2,
                    y: rect1.top + rect1.height / 2,
                };

                const center2 = {
                    x: rect2.left + rect2.width / 2,
                    y: rect2.top + rect2.height / 2,
                };

                // Calculate the distance using the Pythagorean theorem
                const distance = Math.sqrt(Math.pow(center2.x - center1.x, 2) + Math.pow(center2.y - center1.y, 2));

                return distance;
            }

            document.addEventListener("DOMContentLoaded", function () {
                // Cache DOM selections and constant values
                const timelineSteps = Array.from(document.querySelectorAll(".abn_timeline__row_center_step"));
                const contentBoxes = Array.from(document.querySelectorAll(".abn_timeline__row_content_box"));
                const timelineSection = document.querySelector(".abn_timeline__mid");
                const timelineEntryPoint = document.querySelector(".abn_timeline__mid_row");
                const firstTimelineStep = timelineSteps[0];
                const lastTimelineStep = timelineSteps[timelineSteps.length - 1];

                let distanceBetweenSteps = 0;
                let stepDistances = [];
                let ticking = false; // For scroll throttling

                function setTimelineHeight() {
                    distanceBetweenSteps = distanceCalculation(firstTimelineStep, lastTimelineStep);
                    timelineEntryPoint.style.setProperty("--timeline-height", `${distanceBetweenSteps}px`);
                    stepDistances = timelineSteps.map((step) => distanceCalculation(firstTimelineStep, step));
                }

                function updateTimelineHeight() {
                    const sectionRect = timelineSection.getBoundingClientRect();

                    // Skip update if section is not visible
                    if (sectionRect.bottom < 0 || sectionRect.top > window.innerHeight) {
                        ticking = false;
                        return;
                    }

                    const viewportMiddle = window.innerHeight * 0.85; // Simplified viewport middle point
                    const distanceFromMiddle = sectionRect.top - viewportMiddle;
                    const sectionHeight = sectionRect.height;

                    let newHeight, shouldAddViewing;

                    // If we haven't scrolled to the section yet (section is below viewport middle)
                    if (distanceFromMiddle > 0) {
                        newHeight = 0;
                        shouldAddViewing = false;
                    }
                    // If we've scrolled past the entire section
                    else if (distanceFromMiddle <= -sectionHeight) {
                        newHeight = distanceBetweenSteps;
                        shouldAddViewing = true;
                    }
                    // If we're currently scrolling through the section
                    else {
                        // Calculate progress (0 to 1) based on how far we've scrolled through the section
                        const scrollProgress = Math.min(Math.abs(distanceFromMiddle) / sectionHeight, 1);
                        // Set timeline height proportional to scroll progress
                        newHeight = scrollProgress * distanceBetweenSteps;
                        // Let individual steps determine their viewing state based on height
                        shouldAddViewing = null;
                    }

                    timelineEntryPoint.style.setProperty("--timeline-height-dynamic", `${newHeight}px`);

                    // Class manipulation optimization
                    timelineSteps.forEach((step, index) => {
                        const shouldView = shouldAddViewing !== null ? shouldAddViewing : newHeight >= stepDistances[index];
                        step.classList.toggle("viewing", shouldView);
                        if (contentBoxes[index]) {
                            contentBoxes[index].classList.toggle("viewing", shouldView);
                        }
                    });

                    ticking = false;
                }

                // Throttled scroll handler
                function onScroll() {
                    if (!ticking) {
                        requestAnimationFrame(() => {
                            updateTimelineHeight();
                        });
                        ticking = true;
                    }
                }

                // Event listeners with throttling
                window.addEventListener("scroll", onScroll, { passive: true });
                const debouncedResize = debounce(setTimelineHeight, 250);
                window.addEventListener("resize", debouncedResize);

                // Debounce function
                function debounce(func, wait) {
                    let timeout;
                    return function executedFunction(...args) {
                        const later = () => {
                            clearTimeout(timeout);
                            func(...args);
                        };
                        clearTimeout(timeout);
                        timeout = setTimeout(later, wait);
                    };
                }

                // Init
                setTimelineHeight();
                updateTimelineHeight();
            });
        </script>


    </body>
</html>
