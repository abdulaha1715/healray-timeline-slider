<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Document</title>

        <link rel="stylesheet" href="common-style.css">
        <link rel="stylesheet" href="timeline.css">
    </head>
    <body>
    	<br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br>

        <section class="timeline__section relative w-full py-[30px] md:py-[60px] overflow-x-clip bg-white [&amp;_svg_path]:fill-white" id="timeline">

            <div class="timeline__container wrapper flex flex-col items-center w-[1170px] mx-auto p-0 relative max-[1200px]:w-[1004px] max-md:w-[750px] max-sm:w-full max-sm:max-w-[600px] box-border">

                <div class="timeline__mid mb-[20px] max-sm:px-[15px] flex flex-col items-center align-middle w-full max-w-[1030px] mt-[30px]">
                    <div class="timeline__mid_row max-md:p-[25px_0] timeline__entry_point" style="">
                        <div class="timeline__row_center_step absolute left-1/2 ml-[-30px] w-[60px] h-[60px] rounded-[50%] bg-[#ff699f] border-[15px] border-[#2f0147] z-10 viewing"></div>
                        <div class="timeline__mid_week_box w-[39%] text-right mt-[10px] max-md:w-[44%] max-md:mt-[12px] max-sm:float-right max-sm:text-left max-sm:m-0">
                            
                        </div>
                        <div class="timeline__row_content_box card float-left rounded-[10px] relative text-left viewing">
                            <div class="abn-timeline-time">
                                <img
                                    src="https://primalqueen.com/cdn/shop/files/calendar_36x38.png?v=11753303483607372404&format=png"
                                    width="36"
                                    height="38"
                                    alt="icon"
                                    class="calendar inline-block m-[-6px_12px_0_0] max-md:w-[30px] max-sm:w-[25px]"
                                />
                                1 Week
                            </div>

                            <p class="text-center"><b>Feel the change: <br></b>  Reduced gum sensitivity and less bleeding during brushing</p>
                        </div>
                    </div>

                    <div class="timeline__mid_row max-md:p-[25px_0] reverse">
                        <div class="timeline__row_center_step absolute left-1/2 ml-[-30px] w-[60px] h-[60px] rounded-[50%] bg-[#ff699f] border-[15px] border-[#2f0147] z-10"></div>
                        <div class="timeline__mid_week_box w-[39%] text-right mt-[10px] max-md:w-[44%] max-md:mt-[12px] max-sm:float-right max-sm:text-left max-sm:m-0">
                            <div class="week_heading font-medium float-left w-full text-[45px] leading-[50px] text-[#2f0147] max-md:text-[35px] max-md:leading-[40px] max-sm:text-[24px] max-sm:leading-[32px]">
                                
                            </div>
                        </div>
                        <div class="timeline__row_content_box card-reverse float-left w-[38.5%] rounded-[10px] relative text-left">
                        	<div class="abn-timeline-time">
                                <img
                                    src="https://primalqueen.com/cdn/shop/files/calendar_36x38.png?v=11753303483607372404&format=png"
                                    width="36"
                                    height="38"
                                    alt="icon"
                                    class="calendar inline-block m-[-6px_12px_0_0] max-md:w-[30px] max-sm:w-[25px]"
                                />
                                1 Month
                            </div>

                            <p class="text-center"><b>Healthier gums: <br></b> Stronger, firmer, and inflammation noticeably reduced</p>
                        </div>
                    </div>

                    <div class="timeline__mid_row max-md:p-[25px_0]">
                        <div class="timeline__row_center_step absolute left-1/2 ml-[-30px] w-[60px] h-[60px] rounded-[50%] bg-[#ff699f] border-[15px] border-[#2f0147] z-10"></div>
                        <div class="timeline__mid_week_box w-[39%] text-right mt-[10px] max-md:w-[44%] max-md:mt-[12px] max-sm:float-right max-sm:text-left max-sm:m-0">
                            <div class="week_heading font-medium float-left w-full text-[45px] leading-[50px] text-[#2f0147] max-md:text-[35px] max-md:leading-[40px] max-sm:text-[24px] max-sm:leading-[32px]">
                                
                            </div>
                        </div>
                        <div class="timeline__row_content_box card float-left w-[38.5%] rounded-[10px] relative text-left">
                            <div class="abn-timeline-time">
                                <img
                                    src="https://primalqueen.com/cdn/shop/files/calendar_36x38.png?v=11753303483607372404&format=png"
                                    width="36"
                                    height="38"
                                    alt="icon"
                                    class="calendar inline-block m-[-6px_12px_0_0] max-md:w-[30px] max-sm:w-[25px]"
                                />
                                3 Months
                            </div>

                            <p class="text-center"><b>Pinker, stronger gums: <br></b> Reduced recession and improved protection against bacteria</p>
                        </div>
                    </div>

                    <div class="timeline__mid_row max-md:p-[25px_0] reverse">
                        <div class="timeline__row_center_step absolute left-1/2 ml-[-30px] w-[60px] h-[60px] rounded-[50%] bg-[#ff699f] border-[15px] border-[#2f0147] z-10"></div>
                        <div class="timeline__mid_week_box w-[39%] text-right mt-[10px] max-md:w-[44%] max-md:mt-[12px] max-sm:float-right max-sm:text-left max-sm:m-0">
                            <div class="week_heading font-medium float-left w-full text-[45px] leading-[50px] text-[#2f0147] max-md:text-[35px] max-md:leading-[40px] max-sm:text-[24px] max-sm:leading-[32px]">
                                
                            </div>
                        </div>
                        <div class="timeline__row_content_box card-reverse float-left w-[38.5%] rounded-[10px] relative text-left">
                            <div class="abn-timeline-time">
                                <img
                                    src="https://primalqueen.com/cdn/shop/files/calendar_36x38.png?v=11753303483607372404&format=png"
                                    width="36"
                                    height="38"
                                    alt="icon"
                                    class="calendar inline-block m-[-6px_12px_0_0] max-md:w-[30px] max-sm:w-[25px]"
                                />
                                6 Month
                            </div>

                            <p class="text-center"><b>Fully revitalized: <br></b>Firm, pink gums that provide lasting strength and protection</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    	<br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br>

        <script>
            function distanceCalculation(div1, div2) {
                // Get the dimensions and positions of the divs
                const rect1 = div1.getBoundingClientRect();
                const rect2 = div2.getBoundingClientRect();

                // Calculate the center of each div
                const center1 = {
                    x: rect1.left + rect1.width / 2,
                    y: rect1.top + rect1.height / 2,
                };

                const center2 = {
                    x: rect2.left + rect2.width / 2,
                    y: rect2.top + rect2.height / 2,
                };

                // Calculate the distance using the Pythagorean theorem
                const distance = Math.sqrt(Math.pow(center2.x - center1.x, 2) + Math.pow(center2.y - center1.y, 2));

                return distance;
            }

            document.addEventListener("DOMContentLoaded", function () {
                // Cache DOM selections and constant values
                const timelineSteps = Array.from(document.querySelectorAll(".timeline__row_center_step"));
                const contentBoxes = Array.from(document.querySelectorAll(".timeline__row_content_box"));
                const timelineSection = document.querySelector(".timeline__mid");
                const timelineEntryPoint = document.querySelector(".timeline__mid_row");
                const firstTimelineStep = timelineSteps[0];
                const lastTimelineStep = timelineSteps[timelineSteps.length - 1];

                let distanceBetweenSteps = 0;
                let stepDistances = [];
                let ticking = false; // For scroll throttling

                function setTimelineHeight() {
                    distanceBetweenSteps = distanceCalculation(firstTimelineStep, lastTimelineStep);
                    timelineEntryPoint.style.setProperty("--timeline-height", `${distanceBetweenSteps}px`);
                    stepDistances = timelineSteps.map((step) => distanceCalculation(firstTimelineStep, step));
                }

                function updateTimelineHeight() {
                    const sectionRect = timelineSection.getBoundingClientRect();

                    // Skip update if section is not visible
                    if (sectionRect.bottom < 0 || sectionRect.top > window.innerHeight) {
                        ticking = false;
                        return;
                    }

                    const viewportMiddle = window.innerHeight * 0.85; // Simplified viewport middle point
                    const distanceFromMiddle = sectionRect.top - viewportMiddle;
                    const sectionHeight = sectionRect.height;

                    let newHeight, shouldAddViewing;

                    // If we haven't scrolled to the section yet (section is below viewport middle)
                    if (distanceFromMiddle > 0) {
                        newHeight = 0;
                        shouldAddViewing = false;
                    }
                    // If we've scrolled past the entire section
                    else if (distanceFromMiddle <= -sectionHeight) {
                        newHeight = distanceBetweenSteps;
                        shouldAddViewing = true;
                    }
                    // If we're currently scrolling through the section
                    else {
                        // Calculate progress (0 to 1) based on how far we've scrolled through the section
                        const scrollProgress = Math.min(Math.abs(distanceFromMiddle) / sectionHeight, 1);
                        // Set timeline height proportional to scroll progress
                        newHeight = scrollProgress * distanceBetweenSteps;
                        // Let individual steps determine their viewing state based on height
                        shouldAddViewing = null;
                    }

                    timelineEntryPoint.style.setProperty("--timeline-height-dynamic", `${newHeight}px`);

                    // Class manipulation optimization
                    timelineSteps.forEach((step, index) => {
                        const shouldView = shouldAddViewing !== null ? shouldAddViewing : newHeight >= stepDistances[index];
                        step.classList.toggle("viewing", shouldView);
                        if (contentBoxes[index]) {
                            contentBoxes[index].classList.toggle("viewing", shouldView);
                        }
                    });

                    ticking = false;
                }

                // Throttled scroll handler
                function onScroll() {
                    if (!ticking) {
                        requestAnimationFrame(() => {
                            updateTimelineHeight();
                        });
                        ticking = true;
                    }
                }

                // Event listeners with throttling
                window.addEventListener("scroll", onScroll, { passive: true });
                const debouncedResize = debounce(setTimelineHeight, 250);
                window.addEventListener("resize", debouncedResize);

                // Debounce function
                function debounce(func, wait) {
                    let timeout;
                    return function executedFunction(...args) {
                        const later = () => {
                            clearTimeout(timeout);
                            func(...args);
                        };
                        clearTimeout(timeout);
                        timeout = setTimeout(later, wait);
                    };
                }

                // Init
                setTimelineHeight();
                updateTimelineHeight();
            });
        </script>


    </body>
</html>
